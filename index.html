<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨ÙŠØª</title>
    <style>
        /* Ù†ÙØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ù…ÙŠÙ„ Ø¨ØªØ§Ø¹Ù†Ø§ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± */
        :root { 
            --primary: #25D366; --dark: #075E54; --bg: #f2f4f7; 
            --card-bg: #ffffff; --text: #333333; --border: #e0e0e0;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); margin: 0; padding: 0; padding-bottom: 120px; color: var(--text);
        }
        .app-header { 
            background: var(--dark); color: white; padding: 15px 0; 
            text-align: center; position: sticky; top: 0; z-index: 1000; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .app-header h1 { margin: 0; font-size: 1.2rem; font-weight: 700; }
        .container { max-width: 600px; margin: auto; padding: 15px; }
        
        /* Dashboard */
        #dashboard-view { animation: fadeIn 0.3s ease-in-out; }
        .search-wrapper { position: relative; margin-bottom: 20px; }
        .global-search-input { 
            width: 100%; padding: 15px 45px 15px 15px; border-radius: 12px; 
            border: 1px solid transparent; background: white; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); font-size: 16px; transition: 0.3s;
        }
        .global-search-input:focus { border-color: var(--primary); outline: none; }
        .search-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #999; }
        
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .cat-card { 
            background: var(--card-bg); padding: 15px; border-radius: 16px; 
            text-align: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.03); 
            height: 110px; display: flex; flex-direction: column; 
            align-items: center; justify-content: center;
        }
        .cat-card:active { transform: scale(0.96); background-color: #f0fff4; }
        .cat-icon { font-size: 2.2rem; margin-bottom: 8px; }
        .cat-card h3 { margin: 0; font-size: 1rem; color: #444; font-weight: 600; }

        /* Tabs View */
        #tabs-view { display: none; animation: slideUp 0.3s; }
        .nav-bar { 
            display: flex; align-items: center; justify-content: space-between; 
            margin-bottom: 15px; background: white; padding: 10px 15px; 
            border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .back-btn { 
            background: #f0f2f5; border: none; padding: 8px 15px; 
            border-radius: 8px; font-weight: bold; cursor: pointer;
        }
        .cat-title-display { font-size: 1.1rem; font-weight: bold; color: var(--dark); }
        .local-search-input { 
            width: 100%; padding: 12px; border: 1px solid var(--border); 
            border-radius: 10px; margin-bottom: 10px; font-size: 16px; outline: none;
        }

        /* Items */
        .item-container { background: white; margin-bottom: 8px; padding: 12px; border-radius: 12px; border: 1px solid #eee; }
        .main-row { display: flex; align-items: center; }
        .item-label { display: flex; align-items: center; width: 100%; cursor: pointer; padding: 5px 0; }
        input[type="checkbox"] { 
            width: 24px; height: 24px; margin-left: 12px; accent-color: var(--primary); cursor: pointer; 
        }
        .item-text { font-size: 1.05rem; color: #444; }
        input[type="checkbox"]:checked + .item-text { color: var(--dark); font-weight: 600; }

        .details-row { display: none; margin-top: 12px; gap: 10px; padding-top: 10px; border-top: 1px dashed #eee; }
        .details-row.show { display: flex; }
        .qty-input { width: 60px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; text-align: center; font-weight: bold; font-size: 16px; }
        .note-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; background: #fafafa; }

        .add-new-box { margin-top: 20px; background: #fff; padding: 10px; border-radius: 10px; border: 1px dashed #ccc; display: flex; gap: 8px; }
        .add-new-box input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; outline: none; }
        .add-btn { background: #333; color: white; border: none; padding: 0 15px; border-radius: 6px; font-weight: bold; }

        .send-container { position: fixed; bottom: 25px; left: 20px; right: 20px; z-index: 999; display: flex; justify-content: center; pointer-events: none; }
        .send-btn { 
            pointer-events: auto; width: 100%; max-width: 400px; 
            background: var(--primary); color: white; border: none; 
            padding: 16px; font-size: 1.1rem; font-weight: bold; 
            border-radius: 16px; cursor: pointer; box-shadow: 0 8px 20px rgba(37, 211, 102, 0.3); 
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .search-group-title { font-size: 0.9rem; color: #777; margin: 15px 5px 5px 0; font-weight: bold; }
        .no-results { text-align: center; color: #999; margin-top: 30px; }
    </style>
</head>
<body>

<div class="app-header">
    <h1>ğŸ›’ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨ÙŠØª</h1>
</div>

<div class="container">
    
    <div id="dashboard-view">
        <div class="search-wrapper">
            <span class="search-icon">ğŸ”</span>
            <input type="text" class="global-search-input" id="globalSearch" placeholder="Ø¯ÙˆØ±ÙŠ Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ù‡Ù†Ø§..." onkeyup="handleGlobalSearch()">
        </div>
        <div class="grid-container" id="cards-container"></div>
        <div id="global-results" style="display: none;"></div>
    </div>

    <div id="tabs-view">
        <div class="nav-bar">
            <button class="back-btn" onclick="showDashboard()"><span>âœ</span> Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <span class="cat-title-display" id="current-cat-title"></span>
        </div>
        <input type="search" class="local-search-input" id="localSearch" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø¯Ù‡..." onkeyup="handleLocalSearch()">
        <div id="items-list-container"></div>
    </div>

</div>

<div class="send-container">
    <button type="button" class="send-btn" onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“¤</button>
</div>

<script>
    // 1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©)
    const defaultData = {
        veg: { title: "Ø®Ø¶Ø±ÙˆØ§Øª ÙˆÙØ§ÙƒÙ‡Ø©", icon: "ğŸ¥¬", items: ["Ø·Ù…Ø§Ø·Ù…", "Ø®ÙŠØ§Ø±", "Ø¨ØµÙ„", "Ø¨Ø·Ø§Ø·Ø³", "ÙÙ„ÙÙ„", "Ø±ÙˆÙ…ÙŠ", "Ù„ÙŠÙ…ÙˆÙ†", "Ø¬Ø²Ø±", "ÙƒÙˆØ³Ø©", "Ø¨Ø§Ø°Ù†Ø¬Ø§Ù†", "Ø«ÙˆÙ…", "ØªÙØ§Ø­", "Ø¨Ø±ØªÙ‚Ø§Ù„", "Ù…ÙˆØ²", "Ø¬ÙˆØ§ÙØ©", "Ù…Ù†Ø¬Ù‡", "Ø¨Ø·ÙŠØ®", "ÙƒØ³Ø¨Ø±Ù‡", "Ø¨Ù‚Ø¯ÙˆÙ†Ø³", "Ø´Ø¨Øª"] },
        supermarket: { title: "Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª", icon: "ğŸ›’", items: ["Ø£Ø±Ø²", "Ù…ÙƒØ±ÙˆÙ†Ø© Ø§Ø³Ø¨Ø§ÙƒØªÙŠ", "Ù…ÙƒØ±ÙˆÙ†Ø© Ø±ÙŠØ´", "Ø²ÙŠØª", "Ø³ÙƒØ±", "Ø´Ø§ÙŠ", "Ø¨Ù†", "Ù…Ù„Ø­", "Ø®Ù„", "Ø¯Ù‚ÙŠÙ‚", "Ø¹Ù„Ø¨Ù‡ ØªÙˆÙ†Ù‡", "Ø¹Ù„Ø¨Ù‡ Ø°Ø±Ù‡", "ÙƒØ§ØªØ´Ø¨", "Ù…Ø§ÙŠÙˆÙ†Ø§Ø²", "Ø¹Ù„Ø¨Ù‡ Ù…Ø´Ø±ÙˆÙ…", "Ø¨Ø±Ø·Ù…Ø§Ù† ØµÙ„ØµØ©", "Ø¹Ù„Ø¨ ØµÙ„ØµØ©", "Ø²Ø¬Ø§Ø¬Ù‡ Ø¯Ø¨Ø³ Ø±ÙˆÙ…Ø§Ù†", "Ø²Ø¬Ø§Ø¬Ù‡ Ø¨Ø§Ø±Ø¨ÙƒÙŠÙˆ", "Ø²Ø¬Ø§Ø¬Ù‡ ØµÙˆÙŠØ§ ØµÙˆØµ", "Ø²Ø¬Ø§Ø¬Ù‡ Ù…Ø³Ø·Ø±Ø¯Ù‡", "ÙƒÙŠØ§Ø³ Ø®Ù…Ø±ÙŠÙ‡", "ÙƒÙŠØ³ Ø´Ø¹Ø±ÙŠÙ‡", "Ø¹Ù„Ø¨Ù‡ Ù…Ø±Ù‚Ø© Ø¯Ø¬Ø§Ø¬", "Ø¨Ø³ÙƒÙˆØª Ø´ÙˆÙØ§Ù†", "Ø¨ÙŠØ¶", "Ù„Ø¨Ø§Ù†", "Ù…Ø±Ø¨Ù‰", "Ø­Ù„Ø§ÙˆØ©", "Ø¹Ø³Ù„ Ø£Ø¨ÙŠØ¶", "Ø¹Ø³Ù„ Ø§Ø³ÙˆØ¯", "Ø³Ù…Ù†Ø©", "Ø§ÙˆÙƒØ³ÙŠ Ø¨ÙˆØ¯Ø±", "Ø¨Ø¨Ø³ÙŠ", "Ø³ÙŠÙÙŠÙ†"] },
        attar: { title: "Ø§Ù„Ø¹Ø·Ø§Ø±", icon: "ğŸº", items: ["ÙƒÙ…ÙˆÙ†", "ÙƒØ³Ø¨Ø±Ù‡ Ù†Ø§Ø´ÙØ©", "ÙƒØ¨ÙŠØ¨Ù‡ ØµÙŠÙ†ÙŠ", "Ø¯ÙŠÙ…Ø¬Ù„Ø§Ø³", "Ø²Ø¬Ø§Ø¬Ù‡ Ø¬ÙˆØ²Ù‡ Ø§Ù„Ø·ÙŠØ¨", "ÙƒØ±ÙƒÙˆÙ…", "ÙƒØ§Ø±ÙŠ", "Ø¨ÙˆØ¯Ø±Ù‡ Ø²Ø¹ÙØ±Ø§Ù†", "ØªÙˆØ§Ø¨Ù„ Ù…Ø­Ø´ÙŠ", "Ø±Ø² Ø¨Ø³Ù…ØªÙŠ"] },
        meat: { title: "Ù„Ø­ÙˆÙ… ÙˆÙØ±Ø§Ø®", icon: "ğŸ—", items: ["Ù„Ø­Ù…Ø© Ù…ÙØ±ÙˆÙ…Ø©", "Ù„Ø­Ù…Ø© Ù‚Ø·Ø¹", "Ø¨ÙˆÙØªÙŠÙƒ", "Ø¨Ø§Ù†ÙŠÙ‡", "ÙˆØ±Ø§Ùƒ ÙØ±Ø§Ø®", "ÙØ±Ø®Ø© ÙƒØ§Ù…Ù„Ø©", "ÙƒØ¨Ø¯ ÙˆÙ‚ÙˆØ§Ù†Øµ", "Ø³Ø¬Ù‚"] },
        breakfast: { title: "ÙØ·Ø§Ø± ÙˆØ¹Ø´Ø§Ø¡", icon: "ğŸ³", items: ["Ø¹Ù„Ø¨Ù‡ ÙÙˆÙ„", "Ø³Ø§Ù†Ø¯ÙˆØªØ´ ÙÙˆÙ„", "Ø·Ø¹Ù…ÙŠØ©", "Ø³Ø§Ù†Ø¯ÙˆØªØ´ Ø·Ø¹Ù…ÙŠØ©", "Ø·Ø¨Ù‚ Ø¨Ø·Ø§Ø·Ø³ ØµÙˆØ§Ø¨Ø¹", "ÙƒÙŠØ³ Ø´ÙŠØ¨Ø³ÙŠ", "Ø¨ØªÙ†Ø¬Ø§Ù† Ù…Ù‚Ù„ÙŠ", "Ø¨ØªÙ†Ø¬Ø§Ù† Ù…Ø®Ù„Ù„", "ÙØ·ÙŠØ±Ù‡", "Ø¹ÙŠØ´", "ÙÙŠÙ†Ùˆ"] },
        dairy: { title: "Ø£Ù„Ø¨Ø§Ù† ÙˆØ¬Ø¨Ù†", icon: "ğŸ§€", items: ["Ù„Ø¨Ù†", "Ø¹Ù„Ø¨Ù‡ Ù„Ø¨Ù†", "Ø¬Ø¨Ù†Ù‡ Ø¨ÙŠØ¶Ø§Ø¡", "Ø¬Ø¨Ù†Ù‡ Ø±ÙˆÙ…ÙŠ", "Ø¬Ø¨Ù†Ù‡ ÙÙ„Ø§Ù…Ù†Ùƒ", "Ø¬Ø¨Ù†Ù‡ Ø´ÙŠØ¯Ø±", "ØªØ±ÙƒÙŠ Ù…Ø¯Ø®Ù†", "Ù„Ø§Ù†Ø´ÙˆÙ†", "Ø²Ø¨Ø§Ø¯ÙŠ Ø¹Ø§Ø¯ÙŠ", "Ø²Ø¨Ø§Ø¯ÙŠ Ù„Ø§ÙŠØª", "Ù‚Ø´Ø·Ø©"] },
        bakery: { title: "Ø§Ù„ÙØ±Ù†", icon: "ğŸ¥–", items: ["ÙÙŠÙ†Ùˆ Ø¹Ø§Ø¯ÙŠ", "ÙÙŠÙ†Ùˆ Ø³Ù†", "Ø¨Ù‚Ø³Ù…Ø§Ø·", "Ø¯ÙˆÙ†Ø§ØªØ³"] },
        soap: { title: "Ù…Ù†Ø¸ÙØ§Øª", icon: "ğŸ§½", items: ["ØµØ§Ø¨ÙˆÙ† Ø§ØµÙØ±", "ØµØ§Ø¨ÙˆÙ† Ø§Ø®Ø¶Ø±", "Ø¯ÙŠØªÙˆÙ„", "Ø¯ÙˆÙ†ÙŠ", "ÙƒÙ„ÙˆØ± Ø§Ù„ÙˆØ§Ù†", "Ø¨Ø±Ø³ÙŠÙ„ Ø¬Ù„", "Ø¹ØµØ§ÙŠÙ‡ Ø®Ø´Ø¨ Ù„Ù„Ù…Ù‚Ø§Ø´Ù‡", "Ø£ÙƒÙŠØ§Ø³ Ø²Ø¨Ø§Ù„Ù‡ ÙƒØ¨ÙŠØ±Ù‡", "Ø§ÙƒÙŠØ§Ø³ Ø¨Ù„Ø§Ø³ØªÙƒ", "Ø¨Ù„Ø§Ø¯Ø¬", "Ø¬Ù„Ø§Ù†Ø³", "Ø³Ù„Ùƒ Ù†Ø§Ø¹Ù…", "Ø¨Ø±ÙŠÙ„", "Ø¨Ø§ÙƒØª Ù…Ù†Ø§Ø¯ÙŠÙ„", "Ø¨Ø§ÙƒØª Ù…Ù†Ø§Ø¯ÙŠÙ„ Ù…Ø·Ø¨Ø®", "Ù…Ù†Ø§Ø¯ÙŠÙ„ ØªÙˆØ§Ù„ÙŠØª", "ØµØ§Ø¨ÙˆÙ† ÙˆØ´", "Ø´Ø§Ù…Ø¨Ùˆ"] },
        others: { title: "Ø£Ø®Ø±Ù‰", icon: "âœ¨", items: [] }
    };

    let appData = {};
    // 2. Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© (Ø¹Ø´Ø§Ù† Ù„Ù…Ø§ Ù†Ø®Ø±Ø¬ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ù…Ù†Ù†Ø³Ø§Ø´ Ø§Ù„Ù„ÙŠ Ø§Ø®ØªØ±Ù†Ø§Ù‡)
    // Structure: { "Ø·Ù…Ø§Ø·Ù…": {cat: "veg", qty: "2", note: "Ø¬Ø§Ù…Ø¯Ø©"}, ... }
    let sessionOrder = {}; 

    let currentCategoryKey = '';

    function loadData() {
        const saved = localStorage.getItem('myGroceryData_v6');
        appData = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(defaultData));
    }
    function saveData() { localStorage.setItem('myGroceryData_v6', JSON.stringify(appData)); }

    // --- DOM Rendering ---
    function renderDashboard() {
        const grid = document.getElementById('cards-container');
        grid.innerHTML = '';
        Object.keys(appData).forEach(key => {
            const cat = appData[key];
            const card = document.createElement('div');
            card.className = 'cat-card';
            card.onclick = () => openCategory(key);
            card.innerHTML = `<div class="cat-icon">${cat.icon}</div><h3>${cat.title}</h3>`;
            grid.appendChild(card);
        });
    }

    function showDashboard() {
        document.getElementById('tabs-view').style.display = 'none';
        document.getElementById('dashboard-view').style.display = 'block';
        document.getElementById('globalSearch').value = '';
        document.getElementById('global-results').style.display = 'none';
        document.getElementById('cards-container').style.display = 'grid';
        window.scrollTo(0,0);
    }

    function openCategory(key) {
        currentCategoryKey = key;
        document.getElementById('dashboard-view').style.display = 'none';
        document.getElementById('tabs-view').style.display = 'block';
        document.getElementById('current-cat-title').textContent = appData[key].title;
        document.getElementById('localSearch').value = '';
        renderItemsList(key);
        window.scrollTo(0,0);
    }

    function renderItemsList(key, filterText = '') {
        const container = document.getElementById('items-list-container');
        container.innerHTML = '';
        const items = appData[key].items;
        
        items.forEach(item => {
            if (item.includes(filterText)) {
                container.appendChild(createItemElement(item, key));
            }
        });

        const addBox = document.createElement('div');
        addBox.className = 'add-new-box';
        addBox.innerHTML = `
            <input type="text" id="new-item-input" placeholder="Ø¶ÙŠÙÙŠ Ø­Ø§Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø©...">
            <button type="button" class="add-btn" onclick="addNewItem()">+</button>
        `;
        container.appendChild(addBox);
    }

    function createItemElement(itemName, categoryKey) {
        // Ù†ØªØ­Ù‚Ù‚ Ù„Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
        const savedState = sessionOrder[itemName];
        const isChecked = savedState ? true : false;
        const qtyVal = savedState ? savedState.qty : "1";
        const noteVal = savedState ? savedState.note : "";

        const div = document.createElement('div');
        div.className = 'item-container';
        div.innerHTML = `
            <div class="main-row">
                <label class="item-label">
                    <input type="checkbox" name="${itemName}" data-cat="${categoryKey}" 
                           onchange="handleCheck(this)" ${isChecked ? 'checked' : ''}>
                    <span class="item-text">${itemName}</span>
                </label>
            </div>
            <div class="details-row ${isChecked ? 'show' : ''}">
                <input type="number" class="qty-input" placeholder="Ø§Ù„Ø¹Ø¯Ø¯" value="${qtyVal}" 
                       oninput="handleInput('${itemName}', 'qty', this.value)">
                <input type="text" class="note-input" placeholder="Ù…Ù„Ø­ÙˆØ¸Ø©..." value="${noteVal}"
                       oninput="handleInput('${itemName}', 'note', this.value)">
            </div>
        `;
        return div;
    }

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ø£Ù‡Ù… Ø¬Ø²Ø¡) ---

    // 1. Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù€ Checkbox
    function handleCheck(checkbox) {
        const name = checkbox.name;
        const cat = checkbox.getAttribute('data-cat');
        const detailsRow = checkbox.closest('.item-container').querySelector('.details-row');

        if (checkbox.checked) {
            // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø°Ø§ÙƒØ±Ø©
            if (!sessionOrder[name]) {
                sessionOrder[name] = { cat: cat, qty: "1", note: "" };
            }
            detailsRow.classList.add('show');
            setTimeout(() => detailsRow.querySelector('.qty-input').focus(), 100);
        } else {
            // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            delete sessionOrder[name];
            detailsRow.classList.remove('show');
        }
    }

    // 2. Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø§Ù„ÙƒÙ…ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ù„Ø­ÙˆØ¸Ø©
    function handleInput(itemName, field, value) {
        if (sessionOrder[itemName]) {
            sessionOrder[itemName][field] = value;
        }
    }

    function addNewItem() {
        const input = document.getElementById('new-item-input');
        const val = input.value.trim();
        if (val) {
            appData[currentCategoryKey].items.push(val);
            saveData();
            renderItemsList(currentCategoryKey);
        }
    }

    // --- Search Logic ---
    function handleLocalSearch() {
        renderItemsList(currentCategoryKey, document.getElementById('localSearch').value.trim());
    }

    function handleGlobalSearch() {
        const query = document.getElementById('globalSearch').value.trim();
        const resultsContainer = document.getElementById('global-results');
        const cardsContainer = document.getElementById('cards-container');

        if (query === '') {
            resultsContainer.style.display = 'none';
            cardsContainer.style.display = 'grid';
            return;
        }

        cardsContainer.style.display = 'none';
        resultsContainer.style.display = 'block';
        resultsContainer.innerHTML = '';
        let foundAny = false;

        Object.keys(appData).forEach(key => {
            const catItems = appData[key].items.filter(item => item.includes(query));
            if (catItems.length > 0) {
                foundAny = true;
                const title = document.createElement('div');
                title.className = 'search-group-title';
                title.textContent = appData[key].title;
                resultsContainer.appendChild(title);
                catItems.forEach(item => resultsContainer.appendChild(createItemElement(item, key)));
            }
        });
        
        if(!foundAny) resultsContainer.innerHTML = '<div class="no-results">Ù…ÙÙŠØ´ Ø­Ø§Ø¬Ø© Ø¨Ø§Ù„Ø§Ø³Ù… Ø¯Ù‡ ğŸ¤·â€â™‚ï¸</div>';
    }

    // --- Send WhatsApp ---
    function sendOrder() {
        // Ù‡Ù†Ø§ Ø¨Ù†Ø¬ÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© sessionOrder Ù…Ø´ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
        // Ø¹Ø´Ø§Ù† ÙŠØ¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø­Ø§Ø¬Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù‚ÙÙˆÙ„Ø©
        const keys = Object.keys(sessionOrder);

        if (keys.length === 0) {
            alert("Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø¶ÙŠØ© ÙŠØ§ Ø³Øª Ø§Ù„ÙƒÙ„! Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø£ÙˆÙ„ ğŸ˜„");
            return;
        }

        let orderSummary = {};
        keys.forEach(itemName => {
            const item = sessionOrder[itemName];
            const catKey = item.cat;
            
            if (!orderSummary[catKey]) orderSummary[catKey] = [];
            
            let line = `â–«ï¸ ${itemName}: ${item.qty}`;
            if(item.note) line += ` (${item.note})`;
            orderSummary[catKey].push(line);
        });

        let message = "*ğŸ›’ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨ÙŠØª:* %0a";
        Object.keys(orderSummary).forEach(catKey => {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù‚Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø­Ø§Ù„Ø© Ù†Ø§Ø¯Ø±Ø© Ù„Ùˆ ØªÙ… Ù…Ø³Ø­ Ù‚Ø³Ù…)
            const title = appData[catKey] ? appData[catKey].title : catKey;
            message += `%0a*â”â” ${title} â”â”*%0a`;
            orderSummary[catKey].forEach(l => message += l + "%0a");
        });

        // **Ù‡Ø§Ù…: ØªÙØ±ÙŠØº Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„**
        // Ø¹Ø´Ø§Ù† Ù„Ù…Ø§ ØªØ±Ø¬Ø¹ Ù…ØªÙ„Ø§Ù‚ÙŠØ´ Ø§Ù„Ø­Ø§Ø¬Ø© Ù…Ø®ØªØ§Ø±Ø© ØªØ§Ù†ÙŠ
        if(confirm("Ù‡Ù„ ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ØŸ (Ø³ÙŠØªÙ… ØªÙØ±ÙŠØº Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¢Ù†)")) {
            sessionOrder = {}; // Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            showDashboard(); // Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            renderDashboard(); // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… (Ø¹Ø´Ø§Ù† Ù„Ùˆ ÙƒØ§Ù† ÙÙŠÙ‡ Ø­Ø§Ø¬Ø© Ù…ÙØªÙˆØ­Ø© ØªØªØ­Ø¯Ø«)
        }

        const myNumber = "201112233512"; 
        window.open(`https://wa.me/${myNumber}?text=${message}`, '_blank');
    }

    // Init
    loadData();
    renderDashboard();
</script>

</body>
</html>